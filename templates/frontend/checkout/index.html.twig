{% extends 'layout/user.html.twig' %}

{% block title %}Checkout
{% endblock %}

{% block main_content %}
	<div class="container mx-auto p-6" role="main" aria-labelledby="checkout-title">
		<h2 id="checkout-title" class="text-2xl font-bold mb-6">Checkout</h2>

		<form
			action="{{ path('app_frontend_checkout_place_order') }}" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-8" novalidate>

			<!-- Address selection -->
			<section aria-labelledby="address-selection-title">
				<h3 id="address-selection-title" class="text-lg font-semibold mb-4">Select Shipping Address</h3>

				{% if addresses|length > 0 %}
					<fieldset class="space-y-3 border border-gray-300 rounded p-4" role="radiogroup" aria-describedby="address-description">
						<legend id="address-description" class="sr-only">Choose one shipping address</legend>
						{% for address in addresses %}
							<label class="block cursor-pointer rounded border p-3 hover:border-blue-500 focus-within:border-blue-600 focus-within:ring-2 focus-within:ring-blue-500">
								<input type="radio" name="address_id" value="{{ address.id }}" class="mr-3" {% if address.isDefault %} checked {% endif %} required aria-checked="{{ address.isDefault ? 'true' : 'false' }}">
								<span>
									{{ address.line1 }},
									{{ address.city }},
									{{ address.country }}
								</span>
							</label>
						{% endfor %}
					</fieldset>
				{% else %}
					<p class="text-gray-600 mb-4">No saved addresses found. Please add a new address.</p>
				{% endif %}

				<a href="{{ path('app_frontend_address_new', { returnUrl: app.request.uri }) }}" class="inline-block mt-4 text-blue-600 hover:underline focus:outline-none focus:ring-2 focus:ring-blue-500 rounded">
					+ Add New Address
				</a>
			</section>

			<!-- Order summary -->
			<aside aria-labelledby="order-summary-title" class="bg-white rounded-lg shadow p-6">
				<h3 id="order-summary-title" class="text-lg font-semibold mb-4">Order Summary</h3>

				{% if cart.cartItems|length > 0 %}
					<ul class="divide-y divide-gray-200">
						{% set total = 0 %}
						{% for item in cart.cartItems %}
							{% set subtotal = item.product.price * item.quantity %}
							{% set total = total + subtotal %}
							<li class="py-2 flex justify-between items-center">
								<span>{{ item.product.name }}
									x
									{{ item.quantity }}</span>
								<span class="font-semibold">{{currency_with_symbol() ~ subtotal|number_format(2) }}</span>
							</li>
						{% endfor %}
					</ul>

					<p class="mt-6 text-right text-xl font-bold">Total: {{currency_with_symbol() ~ total|number_format(2) }}</p>

					<button type="submit" class="mt-6 w-full bg-blue-600 text-white py-3 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Place order">
						Place Order
					</button>
				{% else %}
					<p class="text-gray-600">Your cart is empty.</p>
				{% endif %}
			</aside>
		</form>
	</div>
{% endblock %}
